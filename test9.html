<html>
    <head>
        <title>Leo's Testing Page </title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    </head>
    <body>

    <a href="javascript:DirectlyRTM('openAskForm');">Execute JavaScript</a>
        
<script>
   if (typeof Object.assign !== "function") {
    Object.assign = function(target) {
        "use strict";

        if (target === null) {
            throw new TypeError("Cannot convert undefined or null to object");
        }

        var to = Object(target);

        for (var index = 1; index < arguments.length; index++) {
            var nextSource = arguments[index];

            if (nextSource !== null) {
                for (var nextKey in nextSource) {
                    if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {
                        to[nextKey] = nextSource[nextKey];
                    }
                }
            }
        }

        return to;
    };
}
setTimeout(function slowStartThree(){ 
setTimeout(function slowStartTwo(window, document) {
     "use strict";
    var SupportWidget = function(config) {
        this.STORAGE_KEY = "_support_widget";

        this.defaults = {
            shouldStartMinimized: true,
        };
        this.config = Object.assign({}, this.defaults, config);
        this.supportMethods = [];
        this.state = {
            isMinimized: this.config.shouldStartMinimized,
        };
        this.wrapper = undefined;
        this.initLocalStorage();
    };

    SupportWidget.prototype.buildWidget = function buildWidget() {
        var wrapper = document.createElement("div");
        var header = this.buildWidgetHeader();

        header.addEventListener("click", function() {
            this.onClickWidgetHeader();
        }.bind(this));
        wrapper.style.backgroundColor = "white";
        wrapper.style.borderRadius = "10px 10px 0 0";
        wrapper.style.boxShadow = "0 0 16px rgba(0, 0, 0, 0.3)";
        wrapper.style.fontFamily = "'PT Sans', Helvetica, Arial, sans-serif";
        wrapper.style.fontSize = "14px";
        wrapper.style.position = "fixed";
        wrapper.style.right = "30px";
        wrapper.style.width = "300px";
        wrapper.style.transition = "bottom 70ms ease-in-out";
        wrapper.style.visibility = "hidden";
        wrapper.appendChild(header);
        wrapper.appendChild(this.buildWidgetContent());

        return wrapper;
    };

    SupportWidget.prototype.buildWidgetHeader = function buildWidgetHeader() {
        var header = document.createElement("h1");
        var titleText = this.config.shouldStartMinimized ? this.config.widgetTitle.minimized : this.config.widgetTitle.maximized;
        var title = document.createTextNode(titleText);

        header.style.backgroundColor = "#7E5279";
        header.style.borderRadius = "10px 10px 0 0";
        header.style.color = "#fff";
        header.style.cursor = "pointer";
        header.style.fontFamily = "'PT Sans', Helvetica, Arial, sans-serif";
        header.style.fontSize = "14px";
        header.style.fontWeight = "normal";
        header.style.margin = 0;
        header.style.padding = "16px 14px 14px";
        header.appendChild(title);

        return header;
    };

    SupportWidget.prototype.buildWidgetContent = function buildWidgetContent() {
        var content = document.createElement("ul");
        var items = this.supportMethods.forEach(function(itemOptions) {
            if (itemOptions.isShown) {
                content.appendChild(this.buildWidgetItem(itemOptions));
            }
        }.bind(this));

        return content;
    };

    SupportWidget.prototype.buildWidgetItem = function buildWidgetItem(options) {
        var item = document.createElement("li");
        var title = document.createElement("a");
        var description = document.createElement("span");
        var arrow = document.createElement("span");
        var titleText = document.createTextNode(options.title);
        var descriptionText = document.createTextNode(options.description);

        arrow.style.borderRight = "1px solid #2f7561";
        arrow.style.borderTop = "1px solid #2f7561";
        arrow.style.height = "7px";
        arrow.style.left = "18px";
        arrow.style.position = "absolute";
        arrow.style.transform = "rotate(45deg)";
        arrow.style.top = "24px";
        arrow.style.width = "7px";

        title.style.color = "#2f7561";
        title.style.display = "block";
        title.style.fontWeight = "bold";
        title.style.marginBottom = "4px";
        title.appendChild(titleText);

        description.style.color = "#41535c";
        description.style.fontSize = "13px";
        description.appendChild(descriptionText);

        item.style.borderBottom = "1px solid #e5e8e9";
        item.style.cursor = "pointer";
        item.style.lineHeight = "1.333";
        item.style.padding = "20px 14px 18px 34px";
        item.style.position = "relative";

        if (options.isNew) {
            var newBadge = document.createElement("span");
            var newBadgeText = document.createTextNode("New");

            newBadge.style.backgroundColor = "#fc0";
            newBadge.style.borderRadius = "5px";
            newBadge.style.color = "#060500";
            newBadge.style.fontSize = "11px";
            newBadge.style.fontWeight = "bold";
            newBadge.style.marginLeft = "10px";
            newBadge.style.padding = "4px 10px 3px";
            newBadge.style.position = "relative";
            newBadge.style.textTransform = "uppercase";
            newBadge.style.top = "-1px";

            newBadge.appendChild(newBadgeText);
            title.appendChild(newBadge);
        }

        item.appendChild(arrow);
        item.appendChild(title);
        item.appendChild(description);

        if (options.footnote) {
            var footnote = document.createElement("span");
            var footnoteText = document.createTextNode(options.footnote);

            footnote.style.color = "#bbb";
            footnote.style.display = "block";
            footnote.style.fontSize = "12px";
            footnote.style.marginTop = "4px";
            footnote.appendChild(footnoteText);
            item.appendChild(footnote);
        }

        item.addEventListener("click", options.onClick);

        return item;
    };

    SupportWidget.prototype.onClickWidgetHeader = function onClickWidgetHeader() {
        var header = this.wrapper.childNodes[0];
        var headerTitle = header.childNodes[0];

        if (this.state.isMinimized) {
            headerTitle.nodeValue = this.config.widgetTitle.maximized;
            this.wrapper.style.bottom = 0;
            this.state.isMinimized = false;
            this.saveStateToLocalStorage();
        } else {
            headerTitle.nodeValue = this.config.widgetTitle.minimized;
            this.wrapper.style.bottom = this.getBottomPosition() + "px";
            this.state.isMinimized = true;
            this.saveStateToLocalStorage();
        }
    };

    SupportWidget.prototype.getBottomPosition = function getBottomPosition() {
        var header = this.wrapper.childNodes[0];
        var headerStyle = window.getComputedStyle(header);
        var wrapperStyle = window.getComputedStyle(this.wrapper);
        var headerHeight = parseInt(headerStyle.height, 10);
        var wrapperHeight = parseInt(wrapperStyle.height, 10);

        return -Math.abs(wrapperHeight - headerHeight);
    };

    SupportWidget.prototype.hide = function hide() {
        this.wrapper.style.display = "none";
    };

    SupportWidget.prototype.show = function show() {
        this.wrapper.style.display = "block";
    };

    SupportWidget.prototype.addSupportMethod = function addSupportMethod(supportMethod) {
        this.supportMethods.push(supportMethod);
    };

    SupportWidget.prototype.localStorageIsSupported = function localStorageIsSupported() {
        try {
            window.localStorage.setItem("test", true);
            window.localStorage.removeItem("test");

            return true;
        } catch(e) {
            return false;
        }
    };

    SupportWidget.prototype.initLocalStorage = function initLocalStorage() {
        if (!this.localStorageIsSupported()) return;
        if (!window.localStorage.getItem(this.STORAGE_KEY)) {
            this.saveStateToLocalStorage();
        }
    };

    SupportWidget.prototype.getStateFromLocalStorage = function getStateFromLocalStorage() {
        if (!this.localStorageIsSupported()) return;
        return JSON.parse(window.localStorage.getItem(this.STORAGE_KEY));
    }

    SupportWidget.prototype.saveStateToLocalStorage = function getStateFromLocalStorage() {
        if (!this.localStorageIsSupported()) return;
        window.localStorage.setItem(this.STORAGE_KEY, JSON.stringify(this.state))
    }

    SupportWidget.prototype.init = function init() {
        this.initLocalStorage();
        this.state = this.getStateFromLocalStorage();
        this.wrapper = this.buildWidget();
        document.body.appendChild(this.wrapper);
        this.wrapper.style.bottom = this.state.isMinimized ? this.getBottomPosition() + "px" : 0;
        this.wrapper.style.visibility = "visible";
    };

    function injectDirectlyRTM() {
        var namespace = "DirectlyRTM";
        var head = document.getElementsByTagName("script")[0];
        var script = document.createElement("script");

        script.id = "directlyRTMScript";
        script.src = "https://www.directly.com/widgets/rtm/embed.js";
        script.async = 1;

        window[namespace] = window[namespace] || function () {
            (window[namespace].cq = window[namespace].cq || []).push(arguments);
        };

        if (document.readyState === "complete" || document.readyState === "loaded" || document.readyState === "interactive") {
            head.parentNode.insertBefore(script, head);
        } else if (window.addEventListener) {
            window.addEventListener("DOMContentLoaded", function() {
                head.parentNode.insertBefore(script, head);
            });
        } else {
            window.attachEvent("onload", function() {
                head.parentNode.insertBefore(script, head);
            });
        }
    }

    function captureZopimSettings() {
        var zopimSettings = undefined;

        console.oldConsoleLog = console.log;
        console.log = function(value) {
            zopimSettings = value;
        }
        $zopim.livechat.debug.livechat();
        console.log = console.oldConsoleLog;
      console.log(console);
			 if(typeof zopimSettings == 'string'){
  	 			zopimSettings =	JSON.parse(zopimSettings);
  }
        return zopimSettings;
    }

    var zopimSettings = captureZopimSettings();
    var widget = new SupportWidget({
        shouldStartMinimized: true,
        widgetTitle: {
            maximized: "Talk to us",
            minimized: "Talk to our artists and agents",
        },
    });
    widget.addSupportMethod({
        title: "Talk to a CD Baby artist",
        description: "Get fast, expert advice from CD Baby artists for simple, how-to questions",
        footnote: " Artists are not employees of CD Baby",
        isNew: true,
        isShown: true,
        onClick: function() {
            DirectlyRTM("maximize");
            widget.hide();
        },
    });
    widget.addSupportMethod({
        title: "Talk to an agent",
        description: "Get answers to complex, account specific questions",
        isNew: false,
        isShown: zopimSettings.account && zopimSettings.account.status$string === "online",
        onClick: function() {
            $zopim.livechat.window.show();
            widget.hide();
        },
    });

    $zopim.livechat.window.onHide(function() {
        if (!$zopim.livechat.isChatting()) {
            widget.show();
            $zopim.livechat.hideAll();
        }
    });

    injectDirectlyRTM();
    DirectlyRTM("config", { id: "8a28122f5c0b6124015c0cc2adaa1bea", metadata:{ "Source" :{"Type": "Support"}} });
    DirectlyRTM("onNavigate", function(data) {
      console.log('data', data)
        if (data.path === "/minimized") {
            widget.show();
        }
    });
    $zopim.livechat.hideAll();
    widget.init();
}(window, document), 1000) }
</script>
    </body>
</html>
